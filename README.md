# SKVP-Python
A Python package for working with SKVP videos and Objects

## Prerequisite

* Python 3
* Numpy
* Scipy

It is recommended to use Anaconda, so Numpy and Scipy are automatically available

## Installation

Currently there is no automatic intallation script for SKVP-Python. In order to make your project work with SKVP-Python, please do **one** of the following **options**:

1. Download this repository and add it to the PYTHONPATH environment variable, so that Python can import files from it

2. Download this repository and add it to the `sys.path` array in your Python application, so that Python can import files from it

3. Copy the file `skvp.py` into your central Python lib directory


## SKVP file format
The SKVP format is a human-readable text file that defines 3D skeleton videos.
For SKVP 3D video player, please install [SKVP-3DPlayer](https://github.com/skvp-owner/SKVP_3DPlayer).

### Main SKVP format features
* It can be edited in a text editor
* It can be automatically compressed using ".gz" compression and still be readable by SKVP-Python and the 3D player
* It contains a header with metadata that can be easily edited, as well as a full list of joint 3D locations for each frame

### SKVP file content example
The below file defines a Kinect2 skeleton video with 3 frames.
* Kinect2 skeletons consist of 25 predefined joints.
* The joint connections defined in the `Connections` define the pairs of joints that have a common edge connecting them, e.g., the right wrist and the right elbow. They tell the 3D player which rendered joints to connect with an edge.
   * The joints are enumerated starting from 1, while the Python library enumerates them from 0 due to array behavior.
* The video frames are defined solely by the joint locations, which are specified according to their order at each frame, separated by `;`, where the location components X,Y,Z of each joints are separated by `,`
```
*SKeleton Video Player File Header*
NumJoints=25
NumberOfFrames=3
FPS=30.0
Connections=4-3,3-21,21-9,21-2,21-5,9-10,10-11,11-12,11-25,12-24,5-6,6-7,7-23,7-8,8-22,2-1,1-17,1-13,17-18,18-19,19-20,13-14,14-15,15-16
JointRadiuses=0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03
ConnectionsRadius=0.015
CameraLocation=0.0,0.0,-4.0

*Video*
-0.3168004589134078,-0.2028211590143818,1.4867903922067722;-0.3478811290777009,0.013105184033980522,1.5135885022403601;-0.37719550340366453,0.22151783899138214,1.5294901806452517;-0.4062048021695382,0.32393827115930746,1.5320747989566024;-0.5085039105104094,0.10420408611467556,1.5078307320964022;-0.5233206780311477,-0.0813498261883726,1.456367688558386;-0.45724092422043183,-0.21300096916717504,1.3014601993044015;-0.4337587486294893,-0.2542490750327812,1.2494846874645016;-0.20850779500669658,0.1475769356711614,1.5008773427225108;-0.04543714352167787,-0.043226006700464926,1.4978278716718907;0.021380424758819436,-0.22860030940320172,1.4189834812041147;0.030062599388125825,-0.28236966147562254,1.4101152840033377;-0.37396029584744517,-0.2087451716368303,1.4624652468673525;-0.3925129501875732,-0.3028901537546192,1.2096611555840713;-0.40779424373926276,-0.555679145047016,1.1799283691580593;-0.30229071957352516,-0.5061923397886559,1.1392058795394464;-0.24866886077020706,-0.19067921568672824,1.4609175272103831;-0.3019996331019347,-0.3084787671000134,1.1992760727152885;-0.2815069427421447,-0.5610242434559747,1.1658346493187763;-0.3012288666785872,-0.4756381870395692,1.1351411535716038;-0.37018864555118475,0.17032104272321205,1.5271543839745882;-0.41203071665650043,-0.293785791821809,1.2047061907987462;-0.40339829219976076,-0.2448653597583634,1.2674145049750716;0.045094237601377284,-0.3424398303125285,1.4194708374669556;-0.014193539759485225,-0.2726823402002655,1.4165885416552717
-0.31689457401132404,-0.2025143033812648,1.486943966013583;-0.3475370332667218,0.013549548827345475,1.5139148973022287;-0.3762523352085959,0.22209058863837117,1.529842424084452;-0.40523859359369807,0.32468299942511253,1.5323317207234606;-0.5078796044166414,0.10462817607918093,1.5071837488017146;-0.5223573416177941,-0.08096652195910628,1.4557278363525783;-0.4571252876435409,-0.21286538363525784,1.3015503245290123;-0.4309248154770696,-0.25542366673472644,1.2488524157724779;-0.2079532188235806,0.14783605151396673,1.502027879012989;-0.045193683757910164,-0.042835796495648566,1.4983832059458129;0.021692375820553993,-0.22758208182950335,1.4187925864430833;0.029344132391792344,-0.28147665088984475,1.4098275072041937;-0.3741125281854121,-0.2082766534558409,1.4623241826751814;-0.39245890740692474,-0.30293957674529737,1.209647929811605;-0.40781015576263085,-0.5556986912449137,1.179845772072346;-0.30238349613942106,-0.5060200614333087,1.139113254340617;-0.2487365106202123,-0.19045619008210612,1.4614270655690227;-0.30185546394572604,-0.3083109805508493,1.1994787033609917;-0.2813208328047845,-0.5607951753609337,1.1655965502411052;-0.30141391121102856,-0.4754905823609482,1.135310054302967;-0.3693972166080196,0.17086485936255552,1.5275118188018593;-0.4050155410298741,-0.29447433980190274,1.2052317613565604;-0.4009895461589702,-0.24634101795183688,1.2692434891032047;0.04375837738143866,-0.3426728350739244,1.4183794839335624;-0.017570106875189777,-0.2694203220600375,1.4215628836178804
-0.3170302394506942,-0.20219202728511515,1.487100670446803;-0.3472138167941012,0.014015571580389723,1.514237000514785;-0.37523353830605477,0.2227207847002892,1.5301734349781215;-0.4043927548155102,0.32543509608006416,1.5325593564885613;-0.5071054519160598,0.10536251128741654,1.5063740560661347;-0.5211980539403758,-0.08028202132617682,1.4549364017290718;-0.457850691966327,-0.21318962073523398,1.3008287355368147;-0.4314246376580314,-0.2553738005541508,1.2484841652308205;-0.20736687293593953,0.14809480265417052,1.503324829227671;-0.04494704453449816,-0.04245517852892637,1.4988064664254241;0.02264406024104047,-0.2260793785319545,1.4183578050024983;0.02941683712780293,-0.2808838695323028,1.408531519145457;-0.37430464576589395,-0.20776544116613926,1.4621934083001498;-0.39236804952988025,-0.30302151799173316,1.2096209894317682;-0.407868795372992,-0.5557333886065983,1.179855638742108;-0.30246079386497493,-0.5060228863899949,1.13908940830015;-0.24885999130013475,-0.19022870545217802,1.4619492573773223;-0.3017068400184717,-0.3081539661816585,1.1996651678047452;-0.28122571125107876,-0.5605724101306645,1.165435476478871;-0.30154926500825174,-0.47531393991551474,1.1354596231471528;-0.36856246160764305,0.1714549752146199,1.527855885293806;-0.4054811442366799,-0.2946028141656699,1.2050987149151362;-0.4008403780126274,-0.24628374585825247,1.2686777209714295;0.04314339628491831,-0.34309201505291687,1.416638560903599;-0.018143429617242267,-0.26796883571547536,1.4244032769694308
```


## Usage

### Usage Example
```
import skvp

# Load an SKVP formatted video from a given path. The file can be compressed with '.gz'
vid = skvp.load('/path/to/skvp_vid.skvp.gz')

# Temporally median filter the joint locations, into a new video
filtered = skvp.median(vid)

# Temporally scale the video into a new video of 100 frames
length_scaled = skvp.create_length_scaled_video(vid, num_frames = 100)

# Print the X location of joint 4 at frame 13
# The first index is the frame and the second index is the joint. The last index isa numpy array of 3 values: (X, Y, Z) 
print(vid.frames[13][4][0])

# Save the manipulated video, uncompressed
skvp.dump(length_scaled, '/path/to/new_video.skvp')

# Save the manipulated video, compressed
skvp.dump(length_scaled, '/path/to/new_video.skvp.gz')
```

### API most common utilities

| Function | Description |
|:--------:|-------------|
| skvp.dump(skvp_video, ostream_or_filename) | Save an SKVP video into a file, given a path or an open stream |
| skvp.dump(skvp_video) | Save an SKVP video file content into a string |
| skvp.load(istream_or_filename) | Load an SKVP video from a path or an open stream |
| skvp.loads(video_string) | Load an SKVP video from a string |
| skvp.create_length_scaled_video(skvp_video, scale = None, num_frames = None, num_seconds = None) | Create a temporally scaled version of the video |
| skvp.create_fps_changed_video(skvp_video, new_fps) | Create a video with changed framerate by temporally scaling it |
| skvp.gradient(skvp_video) | Get a new video object of the temporal gradients |
| skvp.median(skvp_video, mask_size = 3) | Create a temporally median-filtered video |
| skvp.gaussian_filter(skvp_videp, mask_size, std) | Create a temporally Gaussian-filtered video |


